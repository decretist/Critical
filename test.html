<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="css/fonts.css">
    <link rel="stylesheet" href="css/tei-html.css">
    <link rel="stylesheet" href="js/jquery-ui-1.11.4.custom/jquery-ui.css">
    <script type="text/javascript" src="js/CETEI.js"></script>
    <script type="text/javascript" src="js/jquery/jquery-1.11.3.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.11.4.custom/jquery-ui.js"></script>
    <script type="text/javascript" src="js/appcrit.js"></script>
    <script src="js/alpheios-morphlib.js" charset="utf-8"></script>
    <script type="text/javascript">
      var c = new CETEI();
      c.shadowCSS = "css/tei-html.css";
      var app = new appcrit(c, "tei-ab", "tei-div[type=textpart]");
      c.addBehaviors({"handlers":{
        "ab": function(elt) {
          if (elt.previousElementSibling.localName == "tei-head") {
            elt.insertAdjacentHTML('afterbegin', "<span class=\"head\">" + elt.previousElementSibling.innerHTML + " </span>");
          }
        },
        "choice": function(elt) {
          elt.insertAdjacentHTML('afterend', "<br/>");
        },
        // Overrides the default ptr behavior, displaying a short link
        "ptr": function(elt) {
            var link = document.createElement("a");
            link.innerHTML = elt.getAttribute("target").replace(/https?:\/\/([^\/]+)\/.*/, "$1");
            link.href = elt.getAttribute("target");
            return link;
        },
        "gap": ["<span>*</span>"],
        "witDetail": function(elt) {
          var content = document.createElement("span");
          if (elt.hasAttribute("data-empty")) {
            if (elt.getAttribute("type") == "correction-altered") {
              content.innerHTML = " (p.c.) "
            }
            if (elt.getAttribute("type") == "correction-original") {
              content.innerHTML = " (a.c.) "
            }
          } else {
            content.innerHTML = " (" + elt.innerHTML + ") ";
          }
          return content;
        }
      }});
      var data = c.getHTML5('data/Critical.xml', null, function(el){
        if (el.hasAttribute("id")) {
         if (["tei-listwit", "tei-witness", "tei-bibl", "tei-handnote", "tei-person", "tei-item"].includes(el.localName)) {
            var val = $(el).children("tei-abbr[type=siglum]").html();
            if (val) {
              app.references["#" + el.getAttribute("id")] = val;
            } else {
              app.references["#" + el.getAttribute("id")] = el.getAttribute("id");
            }
          }
        }
      });
      data.then(function(TEI){
        $("body").append(TEI);
        app.loadData(TEI);
        if (window.location.hash) {
    			window.location = window.location;
    		}
        $("#loading").remove();
        var section = $("tei-div[type=edition]");
        section.find("tei-ab").each(function(i,elt) {
          var e = $(elt);
          var btns = e.find("span.apps");
          var top = 0;
          var left = 0;
          btns.each(function(i,elt){
            $(elt).find("button").each(function(i,elt) {
              var btn = $(elt);
              var pos = $("#" + app.escapeID(btn.attr("data-app"))).position();
              if (top < pos["top"]) {
                top = pos["top"];
                left = 0;
              } else {
                left++;
              }
              btn.css({"position":"absolute","top":top + "px","left":(left*25) + "px"});
            });
          });
        });
        var morph = new morphlibrary(document);
        morph.activate("lat");
      })
    </script>
    <style media="screen">
      tei-choice {
        display:block;
      }
      tei-choice>tei-seg {
        float: left;
      }
      tei-div {
        display:block;
      }
      tei-div[type=edition] {
        text-align: justify;
        width: 700px;
      }
      tei-div[type=textpart]>tei-head {
        display: none;
      }
      tei-quote[type=lemma] {
        font-style: normal;
        text-transform: uppercase;
      }
      tei-quote {
        font-style: italic;
      }
      tei-seg {
        display: block;
      }
      tei-ab span.apps {
        width: 150px;
        right: 250px;
      }
    </style>
  </head>
  <body>

    <div id="loading">
      <p>âœ»</p>
    </div>
    <div id="controls">
      <div id="editing">
        <ul>
          <li><button onclick="app.undo()" title="undo"><svg class="svg-icon">
            <use xlink:href="#undo-icon"></use>
          </svg></button></li>
          <li><button onclick="app.redo()" title="redo"><svg class="svg-icon">
            <use xlink:href="#redo-icon"></use>
          </svg></button></li>
          <li><button onclick="while (app.log.length > 0) {app.undo();}" title="undo all"><svg class="svg-icon">
            <use xlink:href="#reload-icon"></use>
          </svg></button></li>
        </ul>
      </div>
      <div id="display">
        <form class="">
          <ul>
            <li><input type="checkbox" name="orthographical" value="true"><label for="orthographical">Hide orthographical variants</label></li>
            <li><input type="checkbox" name="morphological" value="true"><label for="morphological">Hide morphological variants</label></li>
            <li><input type="checkbox" name="lexical" value="true"><label for="lexical">Hide lexical variants</label></li>
          </ul>
        </form>
      </div>
    </div>
  </body>
</html>
